# Akile Monitor â€” Cloudflare Worker Edition

> åŸºäº Cloudflare Workers + Durable Objects é‡æ„çš„æœåŠ¡å™¨ç›‘æ§ç³»ç»ŸæœåŠ¡ç«¯

æœ¬é¡¹ç›®æ˜¯ [akile_monitor](https://github.com/akile-network/akile_monitor) Go æœåŠ¡ç«¯çš„å®Œæ•´é‡æ„ï¼Œä½¿ç”¨ Cloudflare è¾¹ç¼˜è®¡ç®—å¹³å°æ›¿ä»£ä¼ ç»Ÿ VPS éƒ¨ç½²ï¼Œå®ç°é›¶è¿ç»´ã€å…¨çƒåŠ é€Ÿã€è‡ªåŠ¨æ‰©ç¼©å®¹ã€‚

---

## ğŸ“ æ¶æ„å¯¹æ¯”

### åŸå§‹æ¶æ„ (Go)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket(/monitor)     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent (Go) â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚   Go Server (Hertz)  â”‚
â”‚  æ¯å°æœåŠ¡å™¨  â”‚     gzip + JSON              â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                             â”‚  â”‚ In-Memory SQLiteâ”‚  â”‚ â† å®æ—¶ç›‘æ§æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket(/ws)           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  Frontend   â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  Web Panel  â”‚     JSON                     â”‚  â”‚ File SQLite DB  â”‚  â”‚ â† ä¸»æœºå…ƒä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Telegram Bot API         â”‚  â”‚ TG Bot Polling  â”‚  â”‚ â† ç¦»çº¿å‘Šè­¦
â”‚  Telegram   â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°æ¶æ„ (Cloudflare Workers + Durable Objects)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent (Go) â”‚ â”€â”€ WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚      Cloudflare Worker           â”‚
â”‚  æ¯å°æœåŠ¡å™¨   â”‚     gzip + JSON              â”‚      (Edge Router)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚                                  â”‚
                                             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚     MonitorDO              â”‚  â”‚
â”‚  Frontend   â”‚ â”€â”€ WebSocket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  â”‚  (Durable Object å•ä¾‹)      â”‚  â”‚
â”‚  Web Panel  â”‚     JSON                     â”‚  â”‚                             â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â”‚  â€¢ Map<name, data>  â† å†…å­˜  â”‚  â”‚
                                             â”‚  â”‚  â€¢ DO Storage      â† æŒä¹…åŒ– â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚  â”‚  â€¢ alarm()         â† å®šæ—¶å™¨ â”‚  â”‚
â”‚  Telegram   â”‚ â—€â”€â”€ fetch() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚  â€¢ Hibernatable WS â† è¿æ¥   â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ˜ å°„è¡¨

| åŸ Go ç»„ä»¶ | Cloudflare Worker å¯¹åº” | è¯´æ˜ |
|---|---|---|
| Hertz HTTP Server | Worker `fetch()` handler | è¾¹ç¼˜è·¯ç”±ï¼Œå…¨çƒ 300+ èŠ‚ç‚¹ |
| å†…å­˜ SQLite (`Data` è¡¨) | Durable Object å†…å­˜ `Map` | å®æ—¶ç›‘æ§æ•°æ®ï¼Œæ¯«ç§’çº§è®¿é—® |
| æ–‡ä»¶ SQLite (`Host` è¡¨) | Durable Object `storage` (æŒä¹…åŒ– KV) | ä¸»æœºå…ƒä¿¡æ¯ï¼Œè‡ªåŠ¨æŒä¹…åŒ– |
| WebSocket `/monitor` | DO Hibernatable WebSocket (tag: `agent`) | Agent è¿æ¥ï¼Œæ”¯æŒä¼‘çœ èŠ‚çœæˆæœ¬ |
| WebSocket `/ws` | DO Hibernatable WebSocket (tag: `viewer`) | å‰ç«¯è¿æ¥ï¼Œå®æ—¶æ¨é€ |
| ç¦»çº¿æ£€æµ‹ Goroutine | DO `alarm()` API (æ¯ 20 ç§’) | æ— éœ€å¸¸é©»è¿›ç¨‹ï¼ŒæŒ‰éœ€å”¤é†’ |
| Telegram Bot (é•¿è½®è¯¢) | Worker `fetch()` è°ƒç”¨ TG API | ä¸»åŠ¨æ¨é€ï¼Œæ— éœ€è½®è¯¢ |
| CORS ä¸­é—´ä»¶ | Worker CORS headers | å…¨å±€è·¨åŸŸæ”¯æŒ |
| `auth_secret` éªŒè¯ | Worker ç¯å¢ƒå˜é‡ + DO å†…éªŒè¯ | Secrets å®‰å…¨å­˜å‚¨ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- [Node.js](https://nodejs.org/) >= 18
- [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/) >= 3.0
- Cloudflare è´¦å·

### 1. å®‰è£…ä¾èµ–

```bash
cd akile-monitor-worker
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `wrangler.toml` ä¸­çš„ `[vars]` éƒ¨åˆ†ï¼Œæˆ–ä½¿ç”¨ Wrangler secrets è®¾ç½®æ•æ„Ÿä¿¡æ¯ï¼š

```bash
# è®¾ç½®è®¤è¯å¯†é’¥ï¼ˆæ¨èä½¿ç”¨ secrets è€Œéæ˜æ–‡ varsï¼‰
npx wrangler secret put AUTH_SECRET
npx wrangler secret put HOOK_TOKEN

# å¦‚éœ€ Telegram é€šçŸ¥
npx wrangler secret put TG_TOKEN
```

**`wrangler.toml` é…ç½®è¯´æ˜ï¼š**

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|
| `AUTH_SECRET` | `"auth_secret"` | Agent è®¤è¯å¯†é’¥ï¼Œå¿…é¡»ä¸å®¢æˆ·ç«¯ `client.json` ä¸­çš„ `auth_secret` ä¸€è‡´ |
| `HOOK_TOKEN` | `"hook_token"` | Hook API è®¿é—®ä»¤ç‰Œ |
| `ENABLE_TG` | `"false"` | æ˜¯å¦å¯ç”¨ Telegram é€šçŸ¥ (`"true"` / `"false"`) |
| `TG_TOKEN` | `""` | Telegram Bot API Token |
| `TG_CHAT_ID` | `"0"` | Telegram é€šçŸ¥ç›®æ ‡ Chat ID |
| `UPDATE_URI` | `"/monitor"` | Agent WebSocket ä¸ŠæŠ¥è·¯å¾„ |
| `WEB_URI` | `"/ws"` | å‰ç«¯ WebSocket è·¯å¾„ |
| `HOOK_URI` | `"/hook"` | Hook æ•°æ®æ‹‰å–è·¯å¾„ |

### 3. æœ¬åœ°å¼€å‘

```bash
npm run dev
```

Wrangler ä¼šå¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ `http://localhost:8787`ï¼‰ï¼Œæ”¯æŒ Durable Objects æœ¬åœ°æ¨¡æ‹Ÿã€‚

### 4. éƒ¨ç½²åˆ° Cloudflare

```bash
npm run deploy
```

éƒ¨ç½²åä¼šå¾—åˆ°ä¸€ä¸ª `https://akile-monitor.<your-subdomain>.workers.dev` çš„ URLã€‚

### 5. é…ç½®å®¢æˆ·ç«¯ Agent

ä¿®æ”¹å®¢æˆ·ç«¯çš„ `client.json`ï¼Œå°† `url` æŒ‡å‘ Worker çš„ WebSocket åœ°å€ï¼š

```json
{
  "auth_secret": "your_auth_secret",
  "url": "wss://akile-monitor.<your-subdomain>.workers.dev/monitor",
  "net_name": "eth0",
  "name": "HK-Server1"
}
```

---

## ğŸ“¡ API å‚è€ƒ

### WebSocket ç«¯ç‚¹

#### `GET /monitor` â€” Agent æ•°æ®ä¸ŠæŠ¥

Agentï¼ˆç›‘æ§å®¢æˆ·ç«¯ï¼‰é€šè¿‡æ­¤ WebSocket è¿æ¥ä¸ŠæŠ¥æœåŠ¡å™¨æŒ‡æ ‡æ•°æ®ã€‚

**è¿æ¥æµç¨‹ï¼š**

1. å»ºç«‹ WebSocket è¿æ¥
2. å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼š`auth_secret` æ˜æ–‡å­—ç¬¦ä¸²
3. æ”¶åˆ° `"auth success"` å›å¤è¡¨ç¤ºè®¤è¯æˆåŠŸ
4. æ­¤åæ¯ç§’å‘é€ gzip å‹ç¼©çš„ JSON æ•°æ®åŒ…

**æ•°æ®åŒ…æ ¼å¼ï¼ˆgzip è§£å‹åï¼‰ï¼š**

```json
{
  "Host": {
    "Name": "HK-Server1",
    "Platform": "ubuntu",
    "PlatformVersion": "22.04",
    "CPU": ["Intel Xeon E5-2680 v4 4 Virtual Core"],
    "MemTotal": 4294967296,
    "SwapTotal": 2147483648,
    "Arch": "x86_64",
    "Virtualization": "kvm",
    "BootTime": 1700000000
  },
  "State": {
    "CPU": 25.5,
    "MemUsed": 1073741824,
    "SwapUsed": 0,
    "NetInTransfer": 1099511627776,
    "NetOutTransfer": 549755813888,
    "NetInSpeed": 1048576,
    "NetOutSpeed": 524288,
    "Uptime": 86400,
    "Load1": 0.5,
    "Load5": 0.3,
    "Load15": 0.2
  },
  "TimeStamp": 1700000000
}
```

#### `GET /ws` â€” å‰ç«¯å®æ—¶æ•°æ®

å‰ç«¯é¢æ¿é€šè¿‡æ­¤ WebSocket è·å–æ‰€æœ‰æœåŠ¡å™¨çš„å®æ—¶æ•°æ®ã€‚

**äº¤äº’æµç¨‹ï¼š**

1. å»ºç«‹ WebSocket è¿æ¥
2. å‘é€ä»»æ„æ¶ˆæ¯è§¦å‘æ•°æ®æ¨é€
3. æ”¶åˆ° `"data: [...]"` æ ¼å¼çš„ JSON æ•°ç»„ï¼ˆæ‰€æœ‰æœåŠ¡å™¨çš„ MonitorDataï¼‰
4. Agent æ¯æ¬¡ä¸ŠæŠ¥æ–°æ•°æ®æ—¶ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šä¸»åŠ¨æ¨é€ç»™æ‰€æœ‰ viewer

**å“åº”æ ¼å¼ï¼š**

```
data: [{"Host":{...},"State":{...},"TimeStamp":1700000000}, ...]
```

---

### REST API ç«¯ç‚¹

#### `GET /info` â€” è·å–ä¸»æœºå…ƒä¿¡æ¯

è¿”å›æ‰€æœ‰å·²æ³¨å†Œçš„ä¸»æœºå•†ä¸š/è¿è¥å…ƒä¿¡æ¯ã€‚

**å“åº”ï¼š**

```json
[
  {
    "name": "HK-Server1",
    "due_time": 1735689600,
    "buy_url": "https://example.com/buy",
    "seller": "CloudVendor",
    "price": "$5/mo"
  }
]
```

#### `POST /info` â€” æ›´æ–°ä¸»æœºå…ƒä¿¡æ¯

åˆ›å»ºæˆ–æ›´æ–°ä¸»æœºçš„å•†ä¸š/è¿è¥å…ƒä¿¡æ¯ã€‚éœ€è¦ `auth_secret` è®¤è¯ã€‚

**è¯·æ±‚ä½“ï¼š**

```json
{
  "auth_secret": "your_auth_secret",
  "name": "HK-Server1",
  "due_time": 1735689600,
  "buy_url": "https://example.com/buy",
  "seller": "CloudVendor",
  "price": "$5/mo"
}
```

**å“åº”ï¼š** `200 "ok"` æˆ– `401 "auth failed"`

#### `GET /hook?token=<hook_token>` â€” æ‹‰å–ç›‘æ§æ•°æ®

é€šè¿‡ Hook Token è®¤è¯ï¼Œè·å–å½“å‰æ‰€æœ‰æœåŠ¡å™¨çš„ç›‘æ§æ•°æ®ã€‚é€‚ç”¨äºç¬¬ä¸‰æ–¹é›†æˆã€‚

**å‚æ•°ï¼š**

| å‚æ•° | è¯´æ˜ |
|---|---|
| `token` | Hook Tokenï¼Œå¿…é¡»ä¸é…ç½®çš„ `HOOK_TOKEN` ä¸€è‡´ |

**å“åº”ï¼š** ä¸ `/ws` æ¨é€çš„æ•°æ®æ ¼å¼ç›¸åŒï¼ˆMonitorData JSON æ•°ç»„ï¼‰

#### `POST /delete` â€” åˆ é™¤ä¸»æœº

ä»ç›‘æ§åˆ—è¡¨ä¸­ç§»é™¤æŒ‡å®šæœåŠ¡å™¨ã€‚éœ€è¦ `auth_secret` è®¤è¯ã€‚

**è¯·æ±‚ä½“ï¼š**

```json
{
  "auth_secret": "your_auth_secret",
  "name": "HK-Server1"
}
```

**å“åº”ï¼š** `200 "ok"` / `401 "auth failed"` / `404 "not found"`

#### `GET /` â€” å¥åº·æ£€æŸ¥

**å“åº”ï¼š**

```json
{
  "name": "akile-monitor",
  "version": "2.0.0",
  "runtime": "cloudflare-workers",
  "status": "running"
}
```

---

## ğŸ— é¡¹ç›®ç»“æ„

```
akile-monitor-worker/
â”œâ”€â”€ wrangler.toml          # Cloudflare Worker é…ç½®ï¼ˆDO ç»‘å®šã€ç¯å¢ƒå˜é‡ã€è¿ç§»ï¼‰
â”œâ”€â”€ package.json           # Node.js ä¾èµ–ä¸è„šæœ¬
â”œâ”€â”€ tsconfig.json          # TypeScript ç¼–è¯‘é…ç½®
â””â”€â”€ src/
    â”œâ”€â”€ index.ts           # Worker å…¥å£ï¼šHTTP è·¯ç”±ã€CORSã€è®¤è¯ã€è¯·æ±‚åˆ†å‘
    â”œâ”€â”€ monitor-do.ts      # MonitorDO Durable Objectï¼šæ ¸å¿ƒçŠ¶æ€ç®¡ç†
    â”‚                        â”œâ”€â”€ WebSocket è¿æ¥ç®¡ç†ï¼ˆagent + viewerï¼‰
    â”‚                        â”œâ”€â”€ å†…å­˜ç›‘æ§æ•°æ®å­˜å‚¨ï¼ˆMapï¼‰
    â”‚                        â”œâ”€â”€ æŒä¹…åŒ–ä¸»æœºå…ƒä¿¡æ¯ï¼ˆDO Storageï¼‰
    â”‚                        â”œâ”€â”€ ç¦»çº¿æ£€æµ‹å®šæ—¶å™¨ï¼ˆalarmï¼‰
    â”‚                        â””â”€â”€ å´©æºƒæ¢å¤å¿«ç…§
    â”œâ”€â”€ types.ts           # TypeScript ç±»å‹å®šä¹‰ï¼ˆå¯¹åº” Go modelï¼‰
    â”œâ”€â”€ telegram.ts        # Telegram é€šçŸ¥ï¼šç¦»çº¿æ£€æµ‹ã€æ¶ˆæ¯æ ¼å¼åŒ–
    â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°ï¼šformatSizeã€parseCPUã€è‡ªç„¶æ’åºã€gzip è§£å‹
```

### æ ¸å¿ƒè®¾è®¡å†³ç­–

#### 1. å•ä¾‹ Durable Object

æ‰€æœ‰çŠ¶æ€é›†ä¸­åœ¨ä¸€ä¸ªåä¸º `"singleton"` çš„ DO å®ä¾‹ä¸­ï¼Œä¸åŸå§‹ Go æœåŠ¡å™¨çš„å•è¿›ç¨‹æ¶æ„ä¿æŒä¸€è‡´ã€‚è¿™ç¡®ä¿äº†ï¼š
- æ‰€æœ‰ Agent çš„æ•°æ®æ±‡èšåˆ°åŒä¸€ä¸ªçŠ¶æ€å®¹å™¨
- æ‰€æœ‰ Viewer ä»åŒä¸€ä¸ªæ•°æ®æºè·å–æ•°æ®
- ç¦»çº¿æ£€æµ‹é€»è¾‘æœ‰å…¨å±€è§†å›¾

#### 2. Hibernatable WebSocket API

ä½¿ç”¨ Cloudflare çš„ [Hibernatable WebSocket API](https://developers.cloudflare.com/durable-objects/api/websockets/) è€Œéæ ‡å‡† WebSocketï¼š
- DO å¯ä»¥åœ¨æ— æ¶ˆæ¯æ—¶ä¼‘çœ ï¼Œé™ä½è®¡è´¹æ—¶é•¿
- WebSocket è¿æ¥åœ¨ä¼‘çœ æœŸé—´ä¿æŒæ´»è·ƒ
- é€šè¿‡ `state.acceptWebSocket()` + `webSocketMessage()` å›è°ƒå¤„ç†

#### 3. æ•°æ®æŒä¹…åŒ–ç­–ç•¥

| æ•°æ®ç±»å‹ | å­˜å‚¨æ–¹å¼ | Key å‰ç¼€ | ç”Ÿå‘½å‘¨æœŸ |
|---|---|---|---|
| å®æ—¶ç›‘æ§æ•°æ® | å†…å­˜ Map + å®šæœŸå¿«ç…§ | `monitor:` | å†…å­˜ä¸ºä¸»ï¼ŒDO é‡å¯æ—¶ä»å¿«ç…§æ¢å¤ï¼ˆ5 åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰ |
| ä¸»æœºå…ƒä¿¡æ¯ | DO Storage æŒä¹…åŒ– | `host:` | æ°¸ä¹…å­˜å‚¨ï¼Œè·Ÿéš DO ç”Ÿå‘½å‘¨æœŸ |
| ç¦»çº¿çŠ¶æ€ | å†…å­˜ Map | â€” | DO ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé‡å¯åé‡æ–°æ£€æµ‹ |

#### 4. å®æ—¶æ¨é€ä¼˜åŒ–

ä¸åŸå§‹ Go å®ç°ä¸åŒï¼ˆviewer å¿…é¡»å‘é€æ¶ˆæ¯æ‰èƒ½æ”¶åˆ°æ•°æ®ï¼‰ï¼Œæ–°æ¶æ„å¢åŠ äº†**ä¸»åŠ¨æ¨é€**ï¼šå½“ä»»ä½• Agent ä¸ŠæŠ¥æ–°æ•°æ®æ—¶ï¼Œæ‰€æœ‰è¿æ¥çš„ Viewer ä¼šç«‹å³æ”¶åˆ°æ›´æ–°ã€‚åŒæ—¶ä¹Ÿä¿ç•™äº†åŸå§‹çš„è¯·æ±‚-å“åº”æ¨¡å¼ä»¥å…¼å®¹ç°æœ‰å‰ç«¯ã€‚

---

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **ä½¿ç”¨ Wrangler Secrets**ï¼šå°† `AUTH_SECRET`ã€`HOOK_TOKEN`ã€`TG_TOKEN` é€šè¿‡ `wrangler secret put` è®¾ç½®ï¼Œé¿å…å†™å…¥ `wrangler.toml`

2. **è‡ªå®šä¹‰åŸŸå**ï¼šé€šè¿‡ Cloudflare Dashboard ä¸º Worker ç»‘å®šè‡ªå®šä¹‰åŸŸåå¹¶å¯ç”¨ SSL

3. **é™æµ**ï¼šå¯åœ¨ Cloudflare Dashboard ä¸­é…ç½® Rate Limiting è§„åˆ™ä¿æŠ¤ API

---

## ğŸ”§ ä¸åŸç‰ˆå®¢æˆ·ç«¯çš„å…¼å®¹æ€§

æœ¬ Worker æœåŠ¡ç«¯ä¸åŸç‰ˆ Go å®¢æˆ·ç«¯ Agent **å®Œå…¨å…¼å®¹**ï¼Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ã€‚åªéœ€ï¼š

1. ä¿®æ”¹ `client.json` ä¸­çš„ `url` å­—æ®µï¼Œå°† `ws://` æ”¹ä¸º `wss://`ï¼ŒæŒ‡å‘ Worker åœ°å€
2. ç¡®ä¿ `auth_secret` ä¸ Worker é…ç½®çš„ `AUTH_SECRET` ä¸€è‡´

```json
{
  "auth_secret": "your_secret_here",
  "url": "wss://your-worker.your-subdomain.workers.dev/monitor",
  "net_name": "eth0",
  "name": "My-Server"
}
```

---

## ğŸ’° æˆæœ¬ä¼°ç®—

Cloudflare Workers Paid è®¡åˆ’ ($5/æœˆ) åŒ…å«ï¼š

| èµ„æº | å…è´¹é¢åº¦ | å…¸å‹ä½¿ç”¨é‡ï¼ˆ10 å°æœåŠ¡å™¨ï¼‰ |
|---|---|---|
| Worker è¯·æ±‚ | 1000 ä¸‡æ¬¡/æœˆ | ~260 ä¸‡æ¬¡/æœˆ (WebSocket æ¶ˆæ¯) |
| DO è¯·æ±‚ | 100 ä¸‡æ¬¡/æœˆ | ~260 ä¸‡æ¬¡/æœˆ |
| DO Duration | 40 ä¸‡ GBÂ·s/æœˆ | æä½ï¼ˆHibernatable WS ä¼‘çœ ï¼‰ |
| DO Storage è¯»å†™ | 100 ä¸‡æ¬¡/æœˆ | ~13 ä¸‡æ¬¡/æœˆï¼ˆalarm å¿«ç…§ï¼‰ |
| DO Storage å®¹é‡ | 1 GB | < 1 MB |

å¯¹äº 10 å°ä»¥ä¸‹æœåŠ¡å™¨çš„å°è§„æ¨¡ç›‘æ§ï¼ŒåŸºæœ¬å¯ä»¥æ§åˆ¶åœ¨ $5/æœˆåŸºç¡€è´¹ç”¨å†…ã€‚

---
